alias: tutorial
description: How to install and update main products
version: 0.9
changes:
  - 0.1 Initial draft
  - 0.2 Added input parameters
  - 0.3 Added local node bootstrap
  - 0.4 Added products/plugins installation
  - 0.5 Added fix installation
  - 0.6 Added main products and fix installation
  - 0.7 Added licenses and runtime instances
  - 0.8 Added configurations
  - 0.9 Added remote server environment support
   
environments:
  default:
    install.dir:     ${}                            # SPM installation directory
    spm.port:        8192                           # SPM connection port
    spm.alias:       dev${spm.port}                 # SPM alias
    repo.product:    ${}                            # Product repository           
    repo.fix:        ${}                            # Fixes repository
    spm.fixes:       ALL                            # Default list of fixes to install
    is.fixes:        ALL                            # Set of IS fixes 
    um.fixes:        ALL                            # Set of UM fixes 
    is.license.key:  ${}                            # Default alias for IS license key
    um.license.key:  ${}                            # Default alias for UM license key

    # configuration
    is.memory.init:  128
    is.memory.max:   512
    um.memory.init:  128
    um.memory.max:   512

    um.instance.port: 9001
    is.um.url:       "nsp://localhost:${um.instance.port}" # proper UM URL

    os.port:         22                            # remote machine SSH port

  server:
    os.credentials:  ${}                           # remote machine SSH credentials
    spm.alias:       ${}
    spm.host:        ${}
    is.um.url:       "nsp://${spm.host}:${um.instance.port}" # proper UM URL

layers:                                            # LAYERS definition
  default:                                         # defaults for all layers
    productRepo: ${repo.product}                   # product repository for this layer 
    fixRepo:     ${repo.fix}                       # fix repository for this layer
  management:                                      # management layer with SPMs
    templates:   [plugins]                         # templates to apply to this layer
  messaging:
    templates:   [um]                              # templates to apply to this layer
  integration:
    templates:   [is]                              # templates to apply to this layer

templates:                                         # TEMPLATES definition
  plugins:                                         # template alias
    products:                                      # product list to install
      ISspm:                                       # Platform Manager Plug-Ins / IS
      NUMspm:                                      # Platform Manager Plug-Ins / UM
    fixes: ${spm.fixes}                            # fixes to install
  is:                                              # template alias
    licenses:                                      # copy lincense from the license repository to a template location
      "IntegrationServer/config/licenseKey.xml": "${is.license.key}" 
    products:                                      # product list to install
      integrationServer:                           # Integration Server productId
        inst1:                                     # instance name to create or update
          primary.port:     5551
          diagnostic.port:  5552
          jmx.port:         5553
          license.file: IntegrationServer/config/licenseKey.xml
          configuration:
            OSGI-IS_inst1:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: '${is.memory.init}'
                  MaxSize: '${is.memory.max}'
            integrationServer-inst1:
              COMMON-WMMESSAGING:
                COMMON-WMMESSAGING-IS_UM_CONNECTION:
                  Messaging:
                    '@alias': IS_UM_CONNECTION
                    Description: system generated Universal Messaging connection alias
                    ClientPrefix: J_jRQtEolDEurgAVIwwwADXaZQs_
                    ShareClientPrefix: 'false'
                    Enabled: 'true'
                    Provider:
                      '@type': UM
                      URL: ${is.um.url}
                      MaxRetryAttempts: '5'
                      RetryInterval: '30000'
                      Auth:
                        '@type': none
                    ExtendedProperties:
                      Property:
                      - '@name': useCSQ
                        $: 'true'
                      - '@name': csqDrainInOrder
                        $: 'true'
                      - '@name': enableRequestReply
                        $: 'true'
                      - '@name': csqSize
                        $: '-1'
                      - '@name': um_followTheMasterForSubscribe
                        $: 'true'
                      - '@name': um_followTheMasterForPublish
                        $: 'true'
    fixes: ${is.fixes}                             # fixes to install

  um:                                              # template alias
    licenses:                                      # copy lincense from the license repository to a template location
      "UniversalMessaging/server/templates/licence.xml": "${um.license.key}"     
    products:                                      # product list to install
      NUMRealmServer:                              # Universal Messaging productId
        inst1:                                     # instance name to create or update
          instance.port:    ${um.instance.port}
          instance.ip:      ${node.host}
          runtimeComponentId: Universal-Messaging-${instance.name}
          license.file: UniversalMessaging/server/templates/licence.xml
          configuration:
            Universal-Messaging-inst1:
              COMMON-MEMORY:
                COMMON-MEMORY:
                  InitSize: '${um.memory.init}'
                  MaxSize:  '${um.memory.max}'
    fixes: ${um.fixes}                             # fixes to install

nodes:                                             # NODES definition
  default:                                         # defaults for any environment type
    default:                                       # default node definition
      port: ${spm.port}                            # SPM connection HTTP/S port
      secure: false                                # do not use SSL port
      bootstrapInfo:
        installDir: ${install.dir}                 # installation directory
        installer:  ${cc.installer}                # cc installer that can be found in cc_home/profiles/CCE/data/installers     
    ${spm.alias}:                                  # definition for specific nodeAlias
      host: localhost                              # Use localhost
  server:
    ${spm.alias}:                                  # definition for specific nodeAlias
      host: ${spm.host}                            # Use specific host
      bootstrapInfo:
        credentials: ${os.credentials}             # remote host credentials
 
provision:                                         # PROVISIONing mapping of layers to nodes
  default:                                         # default environment type
    management:  ${spm.alias}                      # management layer is single node
    messaging:   ${spm.alias}                      # messaging layer is single node
    integration: ${spm.alias}                      # integration layer is single node
  server:                                          # default environment type
    management:  ${spm.alias}                      # management layer is single node
    messaging:   ${spm.alias}                      # messaging layer is single node
    integration: ${spm.alias}                      # integration layer is single node

